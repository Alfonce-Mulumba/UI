<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CRM Mockup ‚Äî Taasi Pochi</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --green:#0fa95a;
  --hover:#e9f7f0;
  --bg:#f8f9fa;
}
body {
  margin:0; font-family:Arial, sans-serif; background:var(--bg);
  display:flex; height:100vh; overflow:hidden;
}
.sidebar {
  width:220px; background:#fff; color:#000; display:flex; flex-direction:column; border-right:1px solid #ddd;
}
.sidebar h2 {
  text-align:center; padding:20px 0; margin:0; font-size:22px; background:#f3f3f3;
}
.sidebar .tab {
  padding:14px 18px; cursor:pointer; font-weight:600; border-bottom:1px solid #eee;
}
.sidebar .tab:hover { background:var(--hover); color:var(--green); }

.main { flex:1; display:flex; flex-direction:row; }

.content {
  flex:2; padding:20px; overflow-y:auto;
}

.search-card {
  background:#fff; padding:16px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);
  margin-bottom:20px;
  position:flex;
   width:calc(50% - 14px)
}
.search-card h3 { margin-top:0; }
.search-card input {
  padding:8px; 
  margin:6px; 
  border:1px solid #ccc; 
  border-radius:6px; 
  width:calc(45% - 14px);
}
.search-card input[type="date"] { 
  width:calc(45% - 14px); 
}
.search-card button {
  background:var(--green); 
  color:#fff; 
  border:none; 
  padding:10px 16px; 
  border-radius:6px; 
  cursor:pointer;
}
.search-card button:hover { 
  background:#0c7a43; 
}

.charts, .stats { 
  display:flex; 
  gap:20px; 
  margin-bottom:20px; 
}
.chart-card {
  flex:1; 
  background:#fff; 
  padding:10px; 
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.06);
  height: 220px; 
  display:flex; 
  flex-direction:column;
}
.chart-card canvas { 
  flex:1; 
  max-height:160px; 
}

.stats { gap:40px; }
.stats .box { 
  background:#fff; 
  padding:12px; 
  border-radius:10px; 
  box-shadow:0 2px 6px rgba(0,0,0,0.06); 
  
  flex:1; 
}
.muted { 
  color:#555; 
  font-size:13px; 
  margin-top:6px; 
}

.chatbot {
  flex:1; 
  border-left:1px solid #ddd; 
  display:none; 
  flex-direction:column; 
  background:#fff;
}
.chat-header {
  background:var(--green); 
  color:#fff; padding:12px; 
  font-weight:600; 
  display:flex; 
  justify-content:space-between;
}
.chat-body { 
  flex:1; 
  padding:12px; 
  overflow-y:auto; 
  background:#f8fff6; 
}
.msg { 
  max-width:70%; 
  padding:10px 14px; 
  margin-bottom:10px; 
  border-radius:14px; 
  font-size:14px;
  line-height:1.4; 
  clear:both; 
  white-space:pre-line; 
}
.msg.bot { 
  background:#e0f8ec; 
  color:#073b26; 
  float:left; 
}
.msg.user { 
  background:#fff; 
  border:1px solid #ddd; 
  float:right; 
}
.typing { 
  display:inline-block; 
  margin:6px 0; 
}
.typing span {
  display:inline-block; 
  width:7px; 
  height:7px; 
  margin-right:5px; 
  background:var(--green);
  border-radius:50%; 
  animation:bounce 1.1s infinite;
}
.typing span:nth-child(2){ animation-delay:0.18s; }
.typing span:nth-child(3){ animation-delay:0.36s; }
@keyframes bounce{0%,80%,100%{transform:scale(0);
}40%{transform:scale(1);
} }

.chat-input { 
  display:flex; 
  padding:8px; 
  border-top:1px solid #eee; 
}
.chat-input input { 
  flex:1; 
  padding:8px;
  width: 7px;
  border:1px solid #ccc; 
  border-radius:8px; 
}
.chat-input button { 
  background:var(--green); 
  color:#fff; 
  border:none; 
  padding:8px 12px; 
  margin-left:6px; 
  border-radius:8px; 
  cursor:pointer; 
}

#chatFab {
  position: absolute; 
  right: 20px; 
  bottom: 20px;
  width: 64px; 
  height: 64px; 
  border-radius: 50%;
  background: #0fa95a; 
  color: white; 
  display: flex; 
  align-items: center; 
  justify-content: center;
  cursor: pointer; 
  box-shadow: 0 6px 16px rgba(0,0,0,0.2);
}
</style>
</head>
<body>

<div class="sidebar">
  <h2>LOANS Soko</h2>
  <div class="tab">Dashboard</div>
  <div class="tab">Prospects</div>
  <div class="tab">Transactions</div>
  <div class="tab">Reports</div>
</div>

<div class="main">
  <div class="content">
    <div class="search-card">
      <h3>Search Customer</h3>
      <input id="custName" placeholder="Enter names"/>
      <input id="custPhone" placeholder="Phone no."/>
      <input id="custID" placeholder="ID No."/>
      <input id="custDob" type="date" placeholder="Date of Birth"/>
      <button onclick="searchCustomer()">Search</button>
    </div>

    <div id="chatFab">üí¨</div>

    <div id="customerData" style="display:none">
      <div class="charts">
        <div class="chart-card">
          <h4>Deposits vs Withdrawals</h4>
          <canvas id="depositsChart"></canvas>
        </div>
        <div class="chart-card">
          <h4>Daily Active Days (30)</h4>
          <canvas id="activityChart"></canvas>
        </div>
      </div>

      <div class="charts">
        <div class="chart-card">
          <h4>Airtime Usage ‚Äî Last 6 months</h4>
          <canvas id="airtimeChart"></canvas>
        </div>
        <div class="chart-card">
          <h4>Quick Stats</h4>
          <div class="muted">Avg monthly received:</div><div id="qAvgReceived">‚Äî</div>
          <div class="muted">Avg balance:</div><div id="qAvgBalance">‚Äî</div>
          <div class="muted">Txn count (6m):</div><div id="qTxnCount">‚Äî</div>
          <div class="muted">Wallet age (months):</div><div id="qWalletAge">‚Äî</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chatbot -->
  <div class="chatbot">
    <div class="chat-header">
      LendiBot
      <span id="closeChat" style="cursor:pointer">‚úï</span>
    </div>
    <div class="chat-body" id="chatBody">
      <div class="msg bot">Please search for a customer first üîç</div>
    </div>
    <div class="chat-input">
      <input id="chatInput" placeholder="Enter option..."/>
      <button id="sendBtn">Send</button>
    </div>
  </div>
</div>

<script>
let searched = false;
let depositsChart, activityChart, airtimeChart;

const customersDB = [
  {name:"John Doe",phone:"0712345678",id:"12345678",dob:"1990-01-01",
   months:[5000,7000,8000,6000,7500,6200,8800,9000,9700,8500,9200,9900],
   withdrawals:[3000,4000,5000,4500,4700,4900,5200,5800,6000,6100,6200,6400],
   dailyActive:Array.from({length:30},()=>Math.floor(Math.random()*4)+1),
   airtime:[200,220,210,250,240,230],
   avgReceived:7000, avgBalance:1500, txnCount:160, walletAge:10 }
];

function searchCustomer(){
  const name=document.getElementById("custName").value.trim();
  const phone=document.getElementById("custPhone").value.trim();
  const id=document.getElementById("custID").value.trim();
  const dob=document.getElementById("custDob").value;

  if(!/^[A-Za-z]+\s[A-Za-z]+$/.test(name)){ alert("Enter two names"); return; }
  if(!/^[0-9]{10}$/.test(phone)){ alert("Phone must be 10 digits"); return; }
  if(!/^[0-9]{8}$/.test(id)){ alert("ID must be 8 digits"); return; }
  if(!dob){ alert("Enter Date of Birth"); return; }

  const c=customersDB[0];
  document.getElementById("qAvgReceived").innerText="Ksh "+c.avgReceived;
  document.getElementById("qAvgBalance").innerText="Ksh "+c.avgBalance;
  document.getElementById("qTxnCount").innerText=c.txnCount;
  document.getElementById("qWalletAge").innerText=c.walletAge;
  document.getElementById("customerData").style.display="block";
  searched = true;

  buildCharts(c);
  resetChat();
}

function buildCharts(c){
  const labels=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

  if(depositsChart) depositsChart.destroy();
  depositsChart=new Chart(document.getElementById('depositsChart'),{
    type:'bar',
    data:{labels,datasets:[
      {label:'Deposits',data:c.months,backgroundColor:'rgba(15,169,90,0.8)'},
      {label:'Withdrawals',data:c.withdrawals,backgroundColor:'rgba(220,53,69,0.4)'},
      {label:'Trend',data:c.months,type:'line',borderColor:'#0f9a5a',tension:0.3,fill:false}
    ]},
    options:{maintainAspectRatio:false,plugins:{legend:{position:'bottom'}},scales:{y:{beginAtZero:true,suggestedMax:12000}}}
  });

  const days=Array.from({length:30},(_,i)=>i+1);
  if(activityChart) activityChart.destroy();
  activityChart=new Chart(document.getElementById('activityChart'),{
    type:'line',
    data:{labels:days,datasets:[{label:'Active Days',data:c.dailyActive,borderColor:'#0fa95a',backgroundColor:'rgba(15,169,90,0.2)',tension:0.25,fill:true}]},
    options:{maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,suggestedMax:6}}}
  });

  if(airtimeChart) airtimeChart.destroy();
  airtimeChart=new Chart(document.getElementById('airtimeChart'),{
    type:'bar',
    data:{labels:['Jan','Feb','Mar','Apr','May','Jun'],datasets:[
      {label:'Airtime',data:c.airtime,backgroundColor:'rgba(6,170,120,0.85)'},
      {label:'Trend',data:c.airtime,type:'line',borderColor:'#006644',tension:0.3,fill:false}
    ]},
    options:{maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,suggestedMax:300}}}
  });
}

const chatFab=document.getElementById("chatFab");
const chatbot=document.querySelector(".chatbot");
const chatBody=document.getElementById("chatBody");
const input=document.getElementById("chatInput");
const sendBtn=document.getElementById("sendBtn");

chatFab.onclick=()=>{
  chatbot.style.display="flex"; 
  chatFab.style.display="none"; 
};

document.getElementById("closeChat").onclick=()=>{
  chatbot.style.display="none"; 
  chatFab.style.display="flex"; 
};

function append(text,who="bot"){
  const el=document.createElement("div");
  el.className="msg "+who; el.textContent=text;
  chatBody.appendChild(el); chatBody.scrollTop=chatBody.scrollHeight;
}

function showTyping(cb){
  const t=document.createElement("div");
  t.className="msg bot";
  t.innerHTML=`<div class="typing"><span></span><span></span><span></span></div>`;
  chatBody.appendChild(t); chatBody.scrollTop=chatBody.scrollHeight;
  setTimeout(()=>{t.remove(); cb();},1000);
}

function resetChat(){
  chatBody.innerHTML="";
  append("Hi Agent üëã\nAsk me customer queries:\n0. SIM SWAP?\n1. Loan 0 Limit?\n00. Main menu","bot");
}

function botReply(q){
  if(q==="0") return "**************";
  if(q==="1") return "Customer limit is 0 because wallet activity is low or account is new.";
  if(q==="00") return "Main menu:\n0. SIM SWAP?\n1. Loan 0 Limit?\n00. Main menu";
  return "Invalid choice. Try again.";
}

sendBtn.onclick=()=>{
  const v=input.value.trim(); if(!v) return;
  append(v,"user"); input.value="";
  if(!searched){ append("‚ö†Ô∏è Please search for a customer first.","bot"); return; }
  showTyping(()=>{ append(botReply(v),"bot"); });
};
input.onkeydown=e=>{if(e.key==="Enter") sendBtn.click();};
</script>
</body>
</html>
